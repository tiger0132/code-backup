# #2. Mr. Kitayuta vs. Bamboos

## 题意

- 给 $n,m,k,p$ 和两个序列 $[a_1,a_2,\ldots,a_n],[h_1,h_2,\ldots,h_n]$。
- 有 $m$ 轮，每轮可以操作 $k$ 次，每次可以选择一个 $i$，让 $h_i$ 变成 $\max(h_i-p,0)$（可以多次操作同一个）。每轮结束后，$h_i$ 会变成 $h_i+a_i$。
- 最小化 $m$ 轮结束后 $h_i$ 最大值。
- $1\le n\le10^5,1\le m\le5000,1\le k\le10,1\le p\le10^9$。

## 解法

首先，根据 $a_i+h_i$ 贪心是错的。

```plain
2 5 1 3
10 7
30 0
```

首先注意到**最小化最大值**，可以考虑二分。然后问题变成，给定 $mid$，能不能让 $m$ 轮结束后，所有的 $h_i\le mid$。

因为并不能把某一轮的操作挪到下一轮，而且并不能减到负数，所以正着做非常麻烦。

考虑反着做。最开始让所有数等于 $mid$，每轮结束后第 $i$ 个数会变成 $-a_i$，每次操作是增加一个数。要求 $m$ 轮之后第 $i$ 个数 $\ge h_i$，且所有数字在任何时候均 $\ge0$。

然后可以开一个堆，按照每个数被减到 $<0$ 的次数从小到大贪。如果到最后都满足条件那么就是可行。

# #120. AGC035D Add and Remove

## 题意

- 给 $n$ 个数 $a_1,a_2,\ldots,a_n$。
- 每次操作可以删掉一个数，并将它左右的两个数加上这个数。
- 求最优操作下剩下的一个数的最小值。
- $2\le n\le18$。

## 解法

首先注意到，答案一定是 $\displaystyle\sum_{i=1}^nx_ia_i$ 的形式，而且 $a_1$ 和 $a_n$ 的系数一定是 $1$。

设 $f(l,r,x,y)$ 为把 $(l,r)$ 之间的数全部删掉之后，对整个序列的答案的影响。且 $a_l$ 会被统计 $x$ 次，$a_r$ 会被统计 $y$ 次。

那么答案是 $f(1,n,1,1)+a_1+a_n$（注意上面并没有计入 $a_1,a_n$ 的贡献）。

考虑枚举中间点。设中间点为 $k$，那么我们的操作方式是，先把 $(l,k)$ 和 $(k,r)$ 删干净，然后删掉 $a_k$。（即 $a_k$ 是 $(l,r)$ 中最后被删除的数）

注意到删掉 $a_k$ 之后，会把这个数加进 $a_l$ 和 $a_r$，即会被统计 $x+y$ 遍。那么所以被加进 $a_k$ 的数也会被统计 $x+y$ 遍。

所以转移就是 $\displaystyle f(l,r,x,y)=\min_{l\le k<r}\{f(l,k,x,x+y)+f(k,r,x+y,y)+(x+y)a_k\}$。